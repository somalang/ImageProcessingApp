<Window x:Class="ImageProcessingApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ImageProcessing.ViewModel"
        xmlns:controls="clr-namespace:ImageProcessing.Views.Controls"
        mc:Ignorable="d"
        Title="Image Processing App"
        Height="600"
        Width="800">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <DockPanel>

        <!-- 메뉴바 -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="파일">
                <MenuItem Header="불러오기" Command="{Binding LoadImageCommand}" />
                <MenuItem Header="원본 보기" Command="{Binding ShowOriginalImageCommand}" />
                <MenuItem Header="삭제" Command="{Binding DeleteImageCommand}" />
                <MenuItem Header="다시 불러오기" Command="{Binding ReloadImageCommand}" />
                <Separator />
                <MenuItem Header="저장" Command="{Binding SaveImageCommand}" />
                <MenuItem Header="종료" Command="{Binding ExitCommand}" />
            </MenuItem>

            <MenuItem Header="편집">
                <MenuItem Header="되돌리기 (Undo)" Command="{Binding UndoCommand}" />
                <MenuItem Header="다시하기 (Redo)" Command="{Binding RedoCommand}" />
                <Separator />
                <MenuItem Header="오려두기" Command="{Binding CutSelectionCommand}" />
                <MenuItem Header="복제" Command="{Binding CopySelectionCommand}" />
                <MenuItem Header="붙여넣기" Command="{Binding PasteCommand}" />
                <MenuItem Header="삭제" Command="{Binding DeleteSelectionCommand}" />
            </MenuItem>

            <MenuItem Header="보기">
                <MenuItem Header="로그 보기" Command="{Binding ShowLogWindowCommand}" />
            </MenuItem>

            <MenuItem Header="필터">
                <MenuItem Header="그레이스케일" Command="{Binding ApplyGrayscaleCommand}" />
                <MenuItem Header="가우시안 블러" Command="{Binding ApplyGaussianBlurCommand}" />
                <MenuItem Header="미디언 필터" Command="{Binding ApplyMedianFilterCommand}" />
                <MenuItem Header="라플라시안" Command="{Binding ApplyLaplacianCommand}" />
                <MenuItem Header="소벨" Command="{Binding ApplySobelCommand}" />
                <MenuItem Header="형태학">
                    <MenuItem Header="이진화..." Command="{Binding ApplyBinarizationCommand}" />
                    <MenuItem Header="팽창..." Command="{Binding ApplyDilationCommand}" />
                    <MenuItem Header="침식..." Command="{Binding ApplyErosionCommand}" />
                </MenuItem>
            </MenuItem>

            <MenuItem Header="FFT">
                <MenuItem Header="푸리에 변환" Command="{Binding FFTCommand}" />
                <MenuItem Header="역 변환" Command="{Binding IFFTCommand}" />
            </MenuItem>

            <MenuItem Header="매칭">
                <MenuItem Header="템플릿 매칭" Command="{Binding TemplateMatchCommand}" />
            </MenuItem>

            <MenuItem Header="분석">
                <MenuItem Header="보고서 생성" Command="{Binding GenerateReportCommand}" />
            </MenuItem>

            <MenuItem Header="설정">
                <MenuItem Header="환경 설정" Command="{Binding OpenSettingsCommand}" />
            </MenuItem>
        </Menu>

        <!-- 상태바 -->
        <StatusBar DockPanel.Dock="Bottom">
            <DockPanel LastChildFill="False" Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=StatusBar}}">
                <StatusBarItem DockPanel.Dock="Left">
                    <TextBlock Text="{Binding CurrentCoordinates}" />
                </StatusBarItem>
                <StatusBarItem DockPanel.Dock="Right" HorizontalContentAlignment="Right">
                    <StackPanel Orientation="Horizontal" Margin="5.0">
                        <TextBlock Text="{Binding ProcessingTime}" Margin="10,0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ZoomPercentage}" Margin="5,0" VerticalAlignment="Center"/>
                        <Button Content="🔍+" Command="{Binding ZoomInCommand}" Margin="2,0"/>
                        <Button Content="🔍-" Command="{Binding ZoomOutCommand}" Margin="2,0"/>
                    </StackPanel>
                </StatusBarItem>
            </DockPanel>
        </StatusBar>

        <!-- 이미지 영역 -->
        <Grid Margin="5">
            <Border BorderBrush="Gray" BorderThickness="1">
                <ScrollViewer x:Name="ImageScrollViewer" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Grid.LayoutTransform>
                            <ScaleTransform x:Name="ImageScaleTransform"/>
                        </Grid.LayoutTransform>

                        <Image x:Name="DisplayImage" 
                               Source="{Binding LoadedImage}" 
                               Stretch="Uniform" 
                               MaxWidth="1400" 
                               MaxHeight="700" 
                               SizeChanged="DisplayImage_SizeChanged"/>

                        <Canvas Background="Transparent"
                                MouseDown="Canvas_MouseDown"
                                MouseMove="Canvas_MouseMove"
                                MouseUp="Canvas_MouseUp"
                                MouseLeave="Canvas_MouseLeave">
                            <Rectangle Stroke="Cyan" 
                                       StrokeThickness="2" 
                                       Fill="#5500FFFF"
                                       Visibility="{Binding SelectionVisibility}"
                                       Canvas.Left="{Binding SelectionRect.X}"
                                       Canvas.Top="{Binding SelectionRect.Y}"
                                       Width="{Binding SelectionRect.Width}"
                                       Height="{Binding SelectionRect.Height}" />
                        </Canvas>
                    </Grid>
                </ScrollViewer>
            </Border>
            <!-- 이미지 프리뷰-->
            <controls:PreviewControl x:Name="PreviewWindow"
                         HorizontalAlignment="Right"
                         VerticalAlignment="Top"
                         Margin="10"/>
        </Grid>

    </DockPanel>
</Window>